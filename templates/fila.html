<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fila de Chamados - Help Desk</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<h1>Fila de Chamados</h1>

{% if session.get('nivel') == 2 %}
    <p><strong>Perfil:</strong> Administrador</p>
{% else %}
    <p><strong>Perfil:</strong> Atendente</p>
{% endif %}

<p>
    <a href="{{ url_for('logout') }}">Logout</a>
</p>

<hr>

{% if tickets %}
<ul>
    {% for ticket in tickets %}
        <li>
            <strong>
                <a href="{{ url_for('ticket_detail', ticket_id=ticket[0]) }}">
                    {{ ticket[1] }}
                </a>
            </strong><br>

            {{ ticket[2] }}<br><br>

            <small>
                <strong>Criado por:</strong> {{ ticket[8] }}<br>
                <strong>Criado em:</strong> {{ ticket[4] }}<br>

                {% if ticket[9] %}
                    <strong>Atendente:</strong> {{ ticket[9] }}<br>
                {% endif %}

                {% if ticket[5] %}
                    <strong>Iniciado em:</strong> {{ ticket[5] }}<br>
                {% endif %}

                {% if ticket[6] %}
                    <strong>Fechado em:</strong> {{ ticket[6] }}<br>
                {% endif %}
            </small>

            <br>

            {% if ticket[7] == 1 %}
                <em><strong>Status:</strong> Ocultado</em><br>
            {% else %}
                <em><strong>Status:</strong> {{ ticket[3] }}</em><br>
            {% endif %}

            <br>

            <!-- AÇÕES: atendente/admin -->
            {% if session.get('nivel') in [1, 2] %}

                {% if ticket[7] == 0 %}

                    {% if ticket[3] == 'Aberto' %}
                        <a href="{{ url_for('start_ticket', ticket_id=ticket[0]) }}">
                            Iniciar atendimento
                        </a>
                        <br>
                    {% endif %}

                    {% if ticket[3] == 'Em andamento' %}
                        <a href="{{ url_for('close_ticket', ticket_id=ticket[0]) }}">
                            Fechar chamado
                        </a>
                        <br>
                    {% endif %}

                    <a href="{{ url_for('hide_ticket', ticket_id=ticket[0]) }}"
                       onclick="return confirm('Deseja ocultar este chamado?');">
                        Ocultar
                    </a>
                    <br>

                {% endif %}

            {% endif %}

            <!-- ADMIN pode desocultar -->
            {% if session.get('nivel') == 2 and ticket[7] == 1 %}
                <small>
                    <strong>Ocultado por:</strong> {{ ticket[10] }}<br>
                    <strong>Ocultado em:</strong> {{ ticket[11] }}
                </small>
                <br>

                <a href="{{ url_for('unhide_ticket', ticket_id=ticket[0]) }}"
                   onclick="return confirm('Deseja desocultar este chamado?');">
                    Desocultar
                </a>
                <br>
            {% endif %}

        </li>
        <hr>
    {% endfor %}
</ul>
{% else %}
<p>Nenhum chamado encontrado.</p>
{% endif %}

</body>
</html>
