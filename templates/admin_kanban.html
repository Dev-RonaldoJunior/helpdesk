{% extends "base.html" %}
{% block title %}Painel Admin{% endblock %}

{% block content %}
<h1>ðŸ‘‘ Painel do Administrador</h1>

<form action="{{ url_for('buscar_ticket') }}" method="get">
    <label>Buscar chamado pelo nÃºmero:</label>
    <input type="text" name="ticket_id" placeholder="Ex: 12">
    <button type="submit">Buscar</button>
</form>

<div class="kanban">

    <!-- ABERTOS -->
    <div class="coluna">
        <h3>ðŸŸ¢ Abertos</h3>

        {% if abertos %}
            {% for item in abertos %}
                {% set t = item.ticket %}
                <div class="card card-ticket">

                    <div class="card-badges">
                        {% if item.unread_count > 0 %}
                            <span class="badge badge-red badge-count">{{ item.unread_count }}</span>
                        {% endif %}
                        {% if item.has_status_update %}
                            <span class="badge badge-yellow"></span>
                        {% endif %}
                    </div>

                    <strong>
                        <a href="{{ url_for('ticket_detail', ticket_id=t.id) }}">
                            Chamado #{{ t.id }} - {{ t.titulo }}
                        </a>
                    </strong>

                    <p>{{ t.descricao }}</p>

                    <small>
                        Criado em: {{ t.created_at }} <br>
                        Criador: {{ t.creator_username }} <br>
                        Status: {{ t.status }} <br>
                        Atendente: {{ t.attendant_username or "â€”" }}
                    </small>
                </div>
            {% endfor %}
        {% else %}
            <p class="vazio">Nenhum chamado aberto.</p>
        {% endif %}

        <div class="paginacao">
            {% if abertos_has_prev %}
                <a href="{{ url_for('admin', abertos_page=abertos_page-1, andamento_page=andamento_page, fechados_page=fechados_page, ocultados_page=ocultados_page) }}">â¬… Anterior</a>
            {% endif %}
            <span>PÃ¡gina {{ abertos_page }}</span>
            {% if abertos_has_next %}
                <a href="{{ url_for('admin', abertos_page=abertos_page+1, andamento_page=andamento_page, fechados_page=fechados_page, ocultados_page=ocultados_page) }}">PrÃ³xima âž¡</a>
            {% endif %}
        </div>
    </div>


    <!-- EM ANDAMENTO -->
    <div class="coluna">
        <h3>ðŸŸ¡ Em andamento</h3>

        {% if andamento %}
            {% for item in andamento %}
                {% set t = item.ticket %}
                <div class="card card-ticket">

                    <div class="card-badges">
                        {% if item.unread_count > 0 %}
                            <span class="badge badge-red badge-count">{{ item.unread_count }}</span>
                        {% endif %}
                        {% if item.has_status_update %}
                            <span class="badge badge-yellow"></span>
                        {% endif %}
                    </div>

                    <strong>
                        <a href="{{ url_for('ticket_detail', ticket_id=t.id) }}">
                            Chamado #{{ t.id }} - {{ t.titulo }}
                        </a>
                    </strong>

                    <p>{{ t.descricao }}</p>

                    <small>
                        Criado em: {{ t.created_at }} <br>
                        Criador: {{ t.creator_username }} <br>
                        Status: {{ t.status }} <br>
                        Atendente: {{ t.attendant_username or "â€”" }}
                    </small>
                </div>
            {% endfor %}
        {% else %}
            <p class="vazio">Nenhum chamado em andamento.</p>
        {% endif %}

        <div class="paginacao">
            {% if andamento_has_prev %}
                <a href="{{ url_for('admin', abertos_page=abertos_page, andamento_page=andamento_page-1, fechados_page=fechados_page, ocultados_page=ocultados_page) }}">â¬… Anterior</a>
            {% endif %}
            <span>PÃ¡gina {{ andamento_page }}</span>
            {% if andamento_has_next %}
                <a href="{{ url_for('admin', abertos_page=abertos_page, andamento_page=andamento_page+1, fechados_page=fechados_page, ocultados_page=ocultados_page) }}">PrÃ³xima âž¡</a>
            {% endif %}
        </div>
    </div>


    <!-- FECHADOS -->
    <div class="coluna">
        <h3>ðŸ”´ Fechados</h3>

        {% if fechados %}
            {% for item in fechados %}
                {% set t = item.ticket %}
                <div class="card card-ticket">

                    <div class="card-badges">
                        {% if item.unread_count > 0 %}
                            <span class="badge badge-red badge-count">{{ item.unread_count }}</span>
                        {% endif %}
                        {% if item.has_status_update %}
                            <span class="badge badge-yellow"></span>
                        {% endif %}
                    </div>

                    <strong>
                        <a href="{{ url_for('ticket_detail', ticket_id=t.id) }}">
                            Chamado #{{ t.id }} - {{ t.titulo }}
                        </a>
                    </strong>

                    <p>{{ t.descricao }}</p>

                    <small>
                        Criado em: {{ t.created_at }} <br>
                        Criador: {{ t.creator_username }} <br>
                        Status: {{ t.status }} <br>
                        Atendente: {{ t.attendant_username or "â€”" }}
                    </small>

                    <br>
                    <a href="{{ url_for('hide_ticket', ticket_id=t.id) }}">ðŸ—‘ Ocultar</a>
                </div>
            {% endfor %}
        {% else %}
            <p class="vazio">Nenhum chamado fechado.</p>
        {% endif %}

        <div class="paginacao">
            {% if fechados_has_prev %}
                <a href="{{ url_for('admin', abertos_page=abertos_page, andamento_page=andamento_page, fechados_page=fechados_page-1, ocultados_page=ocultados_page) }}">â¬… Anterior</a>
            {% endif %}
            <span>PÃ¡gina {{ fechados_page }}</span>
            {% if fechados_has_next %}
                <a href="{{ url_for('admin', abertos_page=abertos_page, andamento_page=andamento_page, fechados_page=fechados_page+1, ocultados_page=ocultados_page) }}">PrÃ³xima âž¡</a>
            {% endif %}
        </div>
    </div>


    <!-- OCULTADOS -->
    <div class="coluna">
        <h3>âš« Ocultados</h3>

        {% if ocultados %}
            {% for item in ocultados %}
                {% set t = item.ticket %}
                <div class="card card-ticket">

                    <div class="card-badges">
                        {% if item.unread_count > 0 %}
                            <span class="badge badge-red badge-count">{{ item.unread_count }}</span>
                        {% endif %}
                        {% if item.has_status_update %}
                            <span class="badge badge-yellow"></span>
                        {% endif %}
                    </div>

                    <strong>
                        <a href="{{ url_for('ticket_detail', ticket_id=t.id) }}">
                            Chamado #{{ t.id }} - {{ t.titulo }}
                        </a>
                    </strong>

                    <p>{{ t.descricao }}</p>

                    <small>
                        Criado em: {{ t.created_at }} <br>
                        Criador: {{ t.creator_username }} <br>
                        Status: {{ t.status }} <br>
                        Ocultado por: {{ t.hider_username or "â€”" }} <br>
                        Ocultado em: {{ t.hidden_at or "â€”" }}
                    </small>

                    <br>
                    <a href="{{ url_for('unhide_ticket', ticket_id=t.id) }}">â™» Desocultar</a>
                </div>
            {% endfor %}
        {% else %}
            <p class="vazio">Nenhum chamado ocultado.</p>
        {% endif %}

        <div class="paginacao">
            {% if ocultados_has_prev %}
                <a href="{{ url_for('admin', abertos_page=abertos_page, andamento_page=andamento_page, fechados_page=fechados_page, ocultados_page=ocultados_page-1) }}">â¬… Anterior</a>
            {% endif %}
            <span>PÃ¡gina {{ ocultados_page }}</span>
            {% if ocultados_has_next %}
                <a href="{{ url_for('admin', abertos_page=abertos_page, andamento_page=andamento_page, fechados_page=fechados_page, ocultados_page=ocultados_page+1) }}">PrÃ³xima âž¡</a>
            {% endif %}
        </div>
    </div>

</div>

<br>
<div style="text-align:center;">
    <a href="{{ url_for('logout') }}">ðŸšª Sair</a>
</div>

{% endblock %}
