<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Help Desk{% endblock %}</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <!-- TOAST (POPUP) -->
    <div id="toast-container"></div>

    {% block content %}{% endblock %}

    <!-- FLASH MESSAGES EM JSON (FORMA MAIS PROFISSIONAL E SEGURA) -->
    <script id="flashed-messages" type="application/json">
        {{ get_flashed_messages(with_categories=true) | tojson }}
    </script>

    <script>
        function showToast(message, type = "info") {
            const container = document.getElementById("toast-container");
            if (!container) return;

            const toast = document.createElement("div");
            toast.className = `toast toast-${type}`;

            toast.innerHTML = `
                <span>${message}</span>
                <button class="toast-close" aria-label="Fechar">×</button>
            `;

            container.appendChild(toast);

            // Botão fechar
            toast.querySelector(".toast-close").addEventListener("click", () => {
                toast.remove();
            });

            // Some sozinho em 3.2s
            setTimeout(() => {
                toast.remove();
            }, 3200);
        }

        // Lê os flashes do Flask em JSON
        try {
            const raw = document.getElementById("flashed-messages").textContent;
            const flashedMessages = JSON.parse(raw || "[]");

            flashedMessages.forEach(([category, msg]) => {
                showToast(msg, category || "info");
            });

        } catch (err) {
            console.error("Erro ao carregar mensagens flash:", err);
        }
    </script>

</body>
</html>
