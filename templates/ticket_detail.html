<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes do Chamado</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<h1>Detalhes do Chamado</h1>

<h2>#{{ ticket['id'] }} - {{ ticket['titulo'] }}</h2>

<hr>

<p>{{ ticket['descricao'] }}</p>

<hr>

<small>
    <p><strong>Status:</strong>
        {% if ticket['is_hidden'] == 1 %}
            Ocultado
        {% else %}
            {{ ticket['status'] }}
        {% endif %}
    </p>

    <p><strong>Criado por:</strong> {{ ticket['creator_name'] }}</p>
    <p><strong>Criado em:</strong> {{ ticket['created_at'] }}</p>

    {% if ticket['attendant_name'] %}
        <p><strong>Atendente:</strong> {{ ticket['attendant_name'] }}</p>
    {% endif %}

    {% if ticket['started_at'] %}
        <p><strong>Atendimento iniciado em:</strong> {{ ticket['started_at'] }}</p>
    {% endif %}

    {% if ticket['closed_at'] %}
        <p><strong>Fechado em:</strong> {{ ticket['closed_at'] }}</p>
    {% endif %}

    {% if session.get('nivel') == 2 and ticket['is_hidden'] == 1 %}
        <hr>
        <p><strong>Ocultado por:</strong> {{ ticket['hider_name'] }}</p>
        <p><strong>Ocultado em:</strong> {{ ticket['hidden_at'] }}</p>
    {% endif %}
</small>

<hr>

<h3>Histórico / Comentários</h3>

{% if comments %}
    <div class="comments-box">
        {% for c in comments %}
            <div class="comment-item">
                <div class="comment-header">
                    <strong>{{ c['author'] }}</strong>
                    <span>{{ c['created_at'] }}</span>
                </div>
                <div class="comment-body">
                    {{ c['comment'] }}
                </div>
            </div>
        {% endfor %}
    </div>
{% else %}
    <p class="vazio">Nenhum comentário ainda.</p>
{% endif %}

<hr>

<h3>Enviar mensagem</h3>

<form method="POST" action="{{ url_for('add_comment', ticket_id=ticket['id']) }}">
    <textarea name="comment" rows="4" placeholder="Digite sua mensagem..." required></textarea>
    <button type="submit">Enviar</button>
</form>

<hr>

<p>
    <a href="{{ url_for('dashboard') }}">Voltar</a>
</p>

</body>
</html>
