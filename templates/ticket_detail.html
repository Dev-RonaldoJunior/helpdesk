{% extends "base.html" %}

{% block title %}Detalhes do Chamado{% endblock %}

{% block content %}

<h1>Detalhes do Chamado</h1>

<h2>#{{ ticket[0] }} - {{ ticket[1] }}</h2>

<hr>

<p>{{ ticket[2] }}</p>

<hr>

<small>
    <p><strong>Status:</strong>
        {% if ticket[7] == 1 %}
            Ocultado
        {% else %}
            {{ ticket[3] }}
        {% endif %}
    </p>

    <p><strong>Criado por:</strong> {{ ticket[8] }}</p>
    <p><strong>Criado em:</strong> {{ ticket[4] }}</p>

    {% if ticket[9] %}
        <p><strong>Atendente:</strong> {{ ticket[9] }}</p>
    {% endif %}

    {% if ticket[5] %}
        <p><strong>Atendimento iniciado em:</strong> {{ ticket[5] }}</p>
    {% endif %}

    {% if ticket[6] %}
        <p><strong>Fechado em:</strong> {{ ticket[6] }}</p>
    {% endif %}

    {% if session.get('nivel') == 2 and ticket[7] == 1 %}
        <hr>
        <p><strong>Ocultado por:</strong> {{ ticket[10] }}</p>
        <p><strong>Ocultado em:</strong> {{ ticket[11] }}</p>
    {% endif %}
</small>

<hr>

<h3>Histórico de Atendimento</h3>

{% if comments %}
    {% for c in comments %}
        <div class="card">
            <small>
                <strong>{{ c[3] }}</strong> • {{ c[2] }}
            </small>
            <p style="margin-top:6px;">{{ c[1] }}</p>
        </div>
    {% endfor %}
{% else %}
    <p class="vazio">Nenhuma mensagem ainda.</p>
{% endif %}

<hr>

<h3>Enviar mensagem</h3>

<form method="POST" action="{{ url_for('add_comment', ticket_id=ticket[0]) }}">
    <textarea name="comment" rows="4" required placeholder="Digite sua mensagem..."></textarea>
    <button type="submit">Enviar</button>
</form>

<hr>

<p style="text-align:center;">
    <a href="{{ url_for('dashboard') }}">Voltar ao Dashboard</a>
</p>

{% endblock %}
