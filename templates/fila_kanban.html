{% extends "base.html" %}
{% block title %}Fila de Atendimento{% endblock %}

{% block content %}
<h1>üõ†Ô∏è Fila de Atendimento</h1>

<form action="{{ url_for('buscar_ticket') }}" method="get">
    <label>Buscar chamado pelo n√∫mero:</label>
    <input type="text" name="ticket_id" placeholder="Ex: 12">
    <button type="submit">Buscar</button>
</form>

<div class="kanban">

    <!-- ABERTOS -->
    <div class="coluna">
        <h3>üü¢ Abertos (Fila)</h3>

        {% if abertos %}
            {% for item in abertos %}
                {% set t = item.ticket %}
                <div class="card card-ticket">

                    <div class="card-badges">
                        {% if item.unread_count > 0 %}
                            <span class="badge badge-red badge-count">{{ item.unread_count }}</span>
                        {% endif %}
                        {% if item.has_status_update %}
                            <span class="badge badge-yellow"></span>
                        {% endif %}
                    </div>

                    <strong>
                        <a href="{{ url_for('ticket_detail', ticket_id=t.id) }}">
                            Chamado #{{ t.id }} - {{ t.titulo }}
                        </a>
                    </strong>

                    <p>{{ t.descricao }}</p>

                    <small>
                        Criado em: {{ t.created_at }} <br>
                        Criador: {{ t.creator_username }} <br>
                        Status: {{ t.status }}
                    </small>

                    <br>
                    <a href="{{ url_for('start_ticket', ticket_id=t.id) }}">‚ñ∂ Iniciar</a>
                </div>
            {% endfor %}
        {% else %}
            <p class="vazio">Nenhum chamado aberto na fila.</p>
        {% endif %}

        <div class="paginacao">
            {% if abertos_has_prev %}
                <a href="{{ url_for('fila', abertos_page=abertos_page-1, andamento_page=andamento_page, fechados_page=fechados_page) }}">‚¨Ö Anterior</a>
            {% endif %}
            <span>P√°gina {{ abertos_page }}</span>
            {% if abertos_has_next %}
                <a href="{{ url_for('fila', abertos_page=abertos_page+1, andamento_page=andamento_page, fechados_page=fechados_page) }}">Pr√≥xima ‚û°</a>
            {% endif %}
        </div>
    </div>


    <!-- EM ANDAMENTO -->
    <div class="coluna">
        <h3>üü° Em andamento (Meus)</h3>

        {% if andamento %}
            {% for item in andamento %}
                {% set t = item.ticket %}
                <div class="card card-ticket">

                    <div class="card-badges">
                        {% if item.unread_count > 0 %}
                            <span class="badge badge-red badge-count">{{ item.unread_count }}</span>
                        {% endif %}
                        {% if item.has_status_update %}
                            <span class="badge badge-yellow"></span>
                        {% endif %}
                    </div>

                    <strong>
                        <a href="{{ url_for('ticket_detail', ticket_id=t.id) }}">
                            Chamado #{{ t.id }} - {{ t.titulo }}
                        </a>
                    </strong>

                    <p>{{ t.descricao }}</p>

                    <small>
                        Criado em: {{ t.created_at }} <br>
                        Criador: {{ t.creator_username }} <br>
                        Status: {{ t.status }}
                    </small>

                    <br>
                    <a href="{{ url_for('close_ticket', ticket_id=t.id) }}">‚úÖ Fechar</a>
                </div>
            {% endfor %}
        {% else %}
            <p class="vazio">Nenhum chamado em andamento.</p>
        {% endif %}

        <div class="paginacao">
            {% if andamento_has_prev %}
                <a href="{{ url_for('fila', abertos_page=abertos_page, andamento_page=andamento_page-1, fechados_page=fechados_page) }}">‚¨Ö Anterior</a>
            {% endif %}
            <span>P√°gina {{ andamento_page }}</span>
            {% if andamento_has_next %}
                <a href="{{ url_for('fila', abertos_page=abertos_page, andamento_page=andamento_page+1, fechados_page=fechados_page) }}">Pr√≥xima ‚û°</a>
            {% endif %}
        </div>
    </div>


    <!-- FECHADOS -->
    <div class="coluna">
        <h3>üî¥ Fechados (Meus)</h3>

        {% if fechados %}
            {% for item in fechados %}
                {% set t = item.ticket %}
                <div class="card card-ticket">

                    <div class="card-badges">
                        {% if item.unread_count > 0 %}
                            <span class="badge badge-red badge-count">{{ item.unread_count }}</span>
                        {% endif %}
                        {% if item.has_status_update %}
                            <span class="badge badge-yellow"></span>
                        {% endif %}
                    </div>

                    <strong>
                        <a href="{{ url_for('ticket_detail', ticket_id=t.id) }}">
                            Chamado #{{ t.id }} - {{ t.titulo }}
                        </a>
                    </strong>

                    <p>{{ t.descricao }}</p>

                    <small>
                        Criado em: {{ t.created_at }} <br>
                        Criador: {{ t.creator_username }} <br>
                        Status: {{ t.status }}
                    </small>

                    <br>
                    <a href="{{ url_for('hide_ticket', ticket_id=t.id) }}">üóë Ocultar</a>
                </div>
            {% endfor %}
        {% else %}
            <p class="vazio">Nenhum chamado fechado.</p>
        {% endif %}

        <div class="paginacao">
            {% if fechados_has_prev %}
                <a href="{{ url_for('fila', abertos_page=abertos_page, andamento_page=andamento_page, fechados_page=fechados_page-1) }}">‚¨Ö Anterior</a>
            {% endif %}
            <span>P√°gina {{ fechados_page }}</span>
            {% if fechados_has_next %}
                <a href="{{ url_for('fila', abertos_page=abertos_page, andamento_page=andamento_page, fechados_page=fechados_page+1) }}">Pr√≥xima ‚û°</a>
            {% endif %}
        </div>
    </div>

</div>

<br>
<div style="text-align:center;">
    <a href="{{ url_for('logout') }}">üö™ Sair</a>
</div>

{% endblock %}
